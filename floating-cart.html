<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout</title>
  <style>
    body { font-family: 'Lato', sans-serif; background: #f5f5f5; padding: 20px; }
    h2 { color: #0E2841; text-align: center; }
    .checkout-box { max-width: 600px; margin: 20px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,.15); }
    input, select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 6px; border: 1px solid #ccc; font-size: 16px; box-sizing: border-box; }
    label { font-weight: bold; margin-top: 12px; display: block; }
    #totals { margin-top: 20px; font-size: 18px; line-height: 1.6; }
    #totals span { font-weight: bold; }
    #paypal-button-container { margin-top: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: left; }
  </style>
</head>
<body>

<div class="checkout-box">
  <h2>Checkout</h2>
  <p style="text-align:center;">Please select your delivery method:</p>

  <label for="method">Delivery Method</label>
  <select id="method">
    <option value="ship">Shipping</option>
    <option value="pickup">Local Pickup â€“ Macon GA</option>
  </select>

  <div id="ship-fields">
    <label for="name">Full Name</label>
    <input id="name" placeholder="Full Name">
    <label for="address1">Address Line 1</label>
    <input id="address1" placeholder="Street Address">
    <label for="address2">Address Line 2</label>
    <input id="address2" placeholder="Apt, Suite, etc.">
    <label for="city">City</label>
    <input id="city" placeholder="City">
    <label for="state">State</label>
    <select id="state">
      <option value="">Select State</option>
      <option value="AL">AL</option><option value="AK">AK</option><option value="AZ">AZ</option>
      <option value="AR">AR</option><option value="CA">CA</option><option value="CO">CO</option>
      <option value="CT">CT</option><option value="DE">DE</option><option value="FL">FL</option>
      <option value="GA">GA</option><option value="HI">HI</option><option value="ID">ID</option>
      <option value="IL">IL</option><option value="IN">IN</option><option value="IA">IA</option>
      <option value="KS">KS</option><option value="KY">KY</option><option value="LA">LA</option>
      <option value="ME">ME</option><option value="MD">MD</option><option value="MA">MA</option>
      <option value="MI">MI</option><option value="MN">MN</option><option value="MS">MS</option>
      <option value="MO">MO</option><option value="MT">MT</option><option value="NE">NE</option>
      <option value="NV">NV</option><option value="NH">NH</option><option value="NJ">NJ</option>
      <option value="NM">NM</option><option value="NY">NY</option><option value="NC">NC</option>
      <option value="ND">ND</option><option value="OH">OH</option><option value="OK">OK</option>
      <option value="OR">OR</option><option value="PA">PA</option><option value="RI">RI</option>
      <option value="SC">SC</option><option value="SD">SD</option><option value="TN">TN</option>
      <option value="TX">TX</option><option value="UT">UT</option><option value="VT">VT</option>
      <option value="VA">VA</option><option value="WA">WA</option><option value="WV">WV</option>
      <option value="WI">WI</option><option value="WY">WY</option>
    </select>
    <label for="zip">Zip</label>
    <input id="zip" placeholder="Zip Code">
  </div>

  <div id="pickup-fields" style="display:none;">
    <label for="pickupName">Pickup Person Name</label>
    <input id="pickupName" placeholder="Name">
    <label for="pickupPhone">Phone Number</label>
    <input id="pickupPhone" placeholder="Phone">
  </div>

  <h3>Order Summary</h3>
  <table id="cartTable">
    <thead>
      <tr><th>Item</th><th>Price</th><th>Qty</th><th>Total</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="totals">
    Subtotal: $<span id="sub">0.00</span><br>
    Tax: $<span id="tax">0.00</span><br>
    Shipping: $<span id="ship">0.00</span><br>
    <b>Total: $<span id="final">0.00</span></b>
  </div>

  <div id="paypal-button-container"></div>
</div>

<script src="https://www.paypal.com/sdk/js?client-id=AZfoLkPa3ut2MSEgAqM5ZINc3mDEHejbOhfjTWiBtdgvCSuBuhQ5Eobajkyxu5cSyTBuBfmwk9mTY4Vu&currency=USD"></script>
<script>
const methodSelect = document.getElementById('method');
const subSpan = document.getElementById('sub');
const taxSpan = document.getElementById('tax');
const shipSpan = document.getElementById('ship');
const finalSpan = document.getElementById('final');
const shipFields = document.getElementById('ship-fields');
const pickupFields = document.getElementById('pickup-fields');
const cartTableBody = document.querySelector('#cartTable tbody');

// --- CART FUNCTIONS ---
function getCart(){ 
  try {
    return JSON.parse(localStorage.getItem('cart') || '[]'); 
  } catch(e) {
    return [];
  }
}
function cartTotal(){ return getCart().reduce((sum,i)=>sum+(Number(i.price)*Number(i.qty)),0); }
function tax(){ return cartTotal()>0 && methodSelect.value==='ship'?cartTotal()*0.07:0; }
function ship(){ return cartTotal()>0 && methodSelect.value==='ship'?8.99:0; }
function grandTotal(){ return cartTotal()+tax()+ship(); }

// --- RENDER CART TABLE ---
function renderCart(){
  const cart = getCart();
  cartTableBody.innerHTML='';
  cart.forEach(item=>{
    const row = document.createElement('tr');
    row.innerHTML=`<td>${item.name}</td><td>$${Number(item.price).toFixed(2)}</td><td>${item.qty}</td><td>$${(Number(item.price)*Number(item.qty)).toFixed(2)}</td>`;
    cartTableBody.appendChild(row);
  });
}

// --- UPDATE TOTALS ---
function updateTotals(){
  renderCart();
  subSpan.innerText = cartTotal().toFixed(2);
  taxSpan.innerText = tax().toFixed(2);
  shipSpan.innerText = ship().toFixed(2);
  finalSpan.innerText = grandTotal().toFixed(2);
}

// --- TOGGLE SHIPPING/PICKUP ---
methodSelect.addEventListener('change', ()=>{
  if(methodSelect.value==='ship'){
    shipFields.style.display='block';
    pickupFields.style.display='none';
  } else {
    shipFields.style.display='none';
    pickupFields.style.display='block';
  }
  updateTotals();
});

// --- PAYPAL BUTTON ---
paypal.Buttons({
  createOrder: function(data, actions){
    const total = grandTotal().toFixed(2);
    if(parseFloat(total) <= 0) {
        alert("Your cart is empty!");
        return;
    }
    return actions.order.create({
      purchase_units: [{
        amount: { value: total }
      }]
    });
  },
  onApprove: function(data, actions){
    return actions.order.capture().then(function(details){
      alert('Transaction completed by ' + details.payer.name.given_name);

      fetch('https://formsubmit.co/ajax/info@dimbrightideas.com', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({
          cart: getCart(),
          total: grandTotal(),
          customer: details.payer.name.given_name,
          shippingMethod: methodSelect.value
        })
      });

      localStorage.removeItem('cart');
      window.location.href="/"; 
    });
  }
}).render('#paypal-button-container');

updateTotals();
</script>
</body>
</html>

